{% extends 'base.html' %}
{% load static %}

{% block content %}

{% comment %}


# -- {% with department="" %}
{% if user.department %}
{% with departmentId=user.department %}
{% endwith %}
{% endif %}
{% endwith %} 


<!-- {% with udetail=userdetail.objects.get(user_id=request.user.id) %}
        {% with user_department=udetail.department %}
        {% endwith %}
{% endwith %} -->

{% endcomment %}



<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js"></script>
<link href="{% static 'admin-lte/plugins/datetimepicker/jquery.datetimepicker.min.css' %}">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.11.0/css/bootstrap-datepicker.min.css">


<!-- Content Header (Page header) -->
<div class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1 class="m-0 text-dark">Dashboard</h1>
            </div><!-- /.col -->
            <div class="col-sm-6">
                <h4 class="breadcrumb float-sm-right">SMS Sent : {{ smscount }}</h4>
                <ol class="breadcrumb float-sm-right">
                    {# <li class="breadcrumb-item"><a href="/">Dashboard</a></li> #}
                    {# <li class="breadcrumb-item active">Dashboard</li> #}
                </ol>
            </div><!-- /.col -->
        </div><!-- /.row -->
    </div><!-- /.container-fluid -->
</div>
<!-- /.content-header -->

<section class="content">
    <div class="container-fluid">
        <div class="col-sm-12 col-xs-12">
             <div class="row"> 
                <div class="col-sm-3 col-xs-12">
                     <lable>Lead Count by Date range: </lable>
                    </div> <div class="col-sm-3 col-xs-12"> 
                        <input id="count_date_range" autocomplete="off" type="text" class="form-control" value="" data-listener-added_ab5c5dd3="true" pwa2-uuid="EDITOR/input-C27-7EF-E307D-D4B" pwa-fake-editor="">
                     </div> <div class="col-sm-3 col-xs-12">
                         <input id="reset_date_range" type="button" class="btn btn-primary" value="Reset" onclick="resetfilter()">
                         </div>
                         </div>
                    <hr> 
                </div>
        <!-- Small boxes (Stat box) -->
        <div class="row">
            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3 class="totl_leads">{{ totalLeads }}</h3>
                        <span id="total_html"><i class="fas fa-info-circle"
                            title=""></i></span>
                        <p>Leads</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-bag"></i>
                    </div>
                    <a href="{% url 'telecaller-lead' %}" class="small-box-footer">More info <i
                            class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>


            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-info">
                    <div class="inner">
                        <h3 class="disqualifd_leads">{{ todaysCall }}</h3>
                        <span id="disqualified_html"><i class="fas fa-info-circle"
                            title=""></i></span>
                        <p>Today's Call</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-bag"></i>
                    </div>
                    <a href="" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div> 
            </div>

            <div class="col-lg-3 col-6">
                <!-- small box -->
                <div class="small-box bg-success">
                    <div class="inner">
                        {% comment %} {% if user_department != 'telecaller' %} {% endcomment %}
                            <h3 class="ConvertedLeads">{{ totalConvertedLeads }}
                            </h3>
                            {% comment %} {% else %} {% endcomment %}
                            <h3>0</h3>
                            <span id="convert_html"><i class="fas fa-info-circle"
                                title=""></i></span>
                        {% comment %} {% endif %} {% endcomment %}
                        <p>conversions Leads</p>
                    </div>
                    <div class="icon">
                        <i class="ion ion-stats-bars"></i>
                    </div>
                    <a href="" class="small-box-footer">More info <i class="fas fa-arrow-circle-right"></i></a>
                </div>
            </div>


        </div>

        {% if user_department != "telecaller" %}
        <div class="col-sm-12 col-xs-12">
            <ul style="list-style: none;display: inline-flex;">
                <li style="padding: 0px 2px;">Scroll :</li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#callbacks-section">Callbacks</a></li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#leadstatus-section">Lead Status</a></li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#leadtype-section">Lead Types</a></li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#weekleads-section">Weekly New Leads</a>
                </li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#monthlead-section">Monthly New Leads</a>
                </li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#newleads-section">Today's Leads</a></li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#updateleads-section">Updates Per Day</a>
                </li>
                <li style="padding: 0px 2px;border-right: 1px solid;"><a href="#leadslog-section">Lead Logs Per Day</a>
                </li>
            </ul>
        </div>
        {% endif %}


        <div class="row" id="callbacks-section">
            <div class="col-md-12 mt-4">
                <div class="card card-info">
                    <div class="card-header" style="height: 58px; display: flex; align-items: center; justify-content: space-between;">
                        <h3 class="card-title filterheader">Callbacks(<span id="callbackfiltercount">{{ callbacksarr.count }}</span>)<img src="{% static 'images/ajax-loader.gif' %}"
                                max-width="30" style="display:none;" id="callload" class="img-responsive" /></h3>
                        <div class="cardfilter" style="display: flex; align-items: center;">
                            <input id="call_date_range" autocomplete="off" Placeholder="Callback Date range"
                                type="text" class="form-control filterdaterange" name="call_date_range" value="">
                            <input id="filterdate_range" autocomplete="off" Placeholder="Callback Date"
                                type="text" class="form-control filterdate" name="filterdate_range" value="">
                            <button type="button" class="btn btn-tool resetfilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools filter1">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <br>
                    <div class="card-body" style="max-height: 300px;overflow: auto;">
                        <div class="card-body table-responsive p-0">
                            <table class="table table-hover text-nowrap">
                                <thead>
                                    <tr>
                                        <th>Lead ID</th>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Callback at</th>
                                        <th>Updated at</th>
                                        <th>Call</th>
                                    </tr>
                                </thead>
                                <tbody id="callbacktable">
                                    {% if callbacksarr.count > 0 %}
                                        {% for callbacks in callbacksarr %}
                                    <tr>
                                        <td>{{ callbacks.id }}</td>
                                        <td><a href="{% url 'lead_update' id=callbacks.id %}" target="_blank">{{ callbacks.name }}</a></td>
                                        <td>{{ callbacks.phone }}</td>
                                        <td>{{ callbacks.created_at }}</td>
                                        <td>{{ callbacks.updated_at }}</td>
                                        <td><a onclick="ivrcall('{{ callbacks.phone }}','{{ callbacks.id }}')" style="color:red" href="javascript:void(0);" class="clicktocall" title="click2call"><i class="fa fa-volume-control-phone"></i></a></td>
                                    </tr>
                                       {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="5">No Calls</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Other sections with similar conversions -->


        <div class="row" id="callbacks-section">
            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header" style="height: 58px; display: flex; align-items: center; justify-content: space-between;">
                        <h3 class="card-title filterheader">Non-updated Callbacks(<span id="pendingcallfiltercount">{{ pendingcallback.count }}</span>)<img src="{% static 'images/ajax-loader.gif' %}"
                                max-width="30" style="display:none;" id="prevcallload" class="img-responsive" /></h3>
                        <div class="cardfilter" style="display: flex; align-items: center; ">
                            <input id="prevcall_date_range" autocomplete="off"
                                Placeholder="Previous Callback Date range" type="text"
                                class="form-control filterdaterange" name="prevcall_date_range" value="">
                            <input id="prevfilterdate_range" autocomplete="off"
                                Placeholder="Previous Callback Date" type="text"
                                class="form-control filterdate" name="prevfilterdate_range" value="">
                            <button type="button" class="btn btn-tool resetfilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools filter1">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <br>
                    <div class="card-body" style="max-height: 300px;overflow: auto;">
                        <div class="card-body table-responsive p-0">
                            <table class="table table-hover text-nowrap">
                                <thead>
                                    <tr>
                                        <th>Lead ID</th>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Callback at</th>
                                        <th>Updated at</th>
                                        <th>Call</th>
                                    </tr>
                                </thead>
                                <tbody id="prevcallbacktable">
                                    {% for callbacks in pendingcallback %}
                                    <tr>
                                        <td>{{ callbacks.id }}</td>
                                        <td><a href="{% url 'lead_update' id=callbacks.id %}" target="_blank">{{ callbacks.name }}</a></td>
                                        <td>{{ callbacks.phone }}</td>
                                        <td>{{ callbacks.created_at }}</td>
                                        <td>{{ callbacks.updated_at }}</td>
                                        <td><a onclick="ivrcall('{{ callbacks.phone }}')" style="color:red" href="javascript:void(0);" class="clicktocall" title="click2call"><i class="fa fa-volume-control-phone"></i></a></td>
                                    </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        {% if user_department != 'telecaller' %}


        <div class="row" id="leadstatus-section">
            <div class="col-md-12">
                <div class="card card-success">
                    <div class="card-header">
                        <h3 class="card-title">Lead Status</h3>
                        <div class="graphcardfilter">
                            <input id="status_date_range" autocomplete="off" placeholder="Filter by Created Date range"
                                type="text" class="form-control" name="status_date_range" value="">
                        </div>
                        <div class="datestatus">
                            <input id="status_update_date_range" autocomplete="off"
                                placeholder="Filter by Updated Date range" type="text" class="form-control"
                                name="status_update_date_range" value="">
                            <button type="button" class="btn btn-tool graphresetfilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools graphfilter">
                            <img src="{% static 'images/ajax-loader.gif' %}" max-width="30" style="display:none;"
                                id="statusload" class="img-responsive" />
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove"><i
                                    class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <div class="chart" id="leadstatuschart">

                            </div>

                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
        </div>

        <div class="row" id="leadsource-section">
            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">Lead Source</h3>
                        <div class="leadgraphfilter">
                            <input id="source_date_range" autocomplete="off" placeholder="Filter by Created Date range"
                                type="text" class="form-control" name="source_date_range" value="">
                        </div>
                        <div class="datestatus">
                            <button type="button" class="btn btn-tool leadsourcefilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools graphfilter" style="margin-right: 0.375rem !important;">
                            <img src="{% static 'images/ajax-loader.gif' %}" max-width="30" style="display:none;"
                                id="sourceload" class="img-responsive" />
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove"><i
                                    class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <div class="chart" id="leadsourcechart">

                            </div>

                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
        </div>

        <div class="row" id="leadtype-section">
            <div class="col-md-12">
                <div class="card card-primary">
                    <div class="card-header">
                        <h3 class="card-title">Lead Type</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove"><i
                                    class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <canvas id="leadTypeChartDashboard"
                                style="min-height: 250px; height: 250px; max-height: 250px; width: 100%;"></canvas>
                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
        </div>

        <div class="row" id="weekleads-section">
            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header">
                        <h3 class="card-title">Weekly New Leads</h3>
                        <div class="cardfilter">
                            <input id="weekly_date_range" autocomplete="off" placeholder="Filter by Date range"
                                type="text" class="form-control" name="weekly_date_range" value="">
                            <button type="button" class="btn btn-tool resetfilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools filter1">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <div class="chart" id="weeklyleadchart">

                            </div>
                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
        </div>

        <div class="row" id="monthlead-section">
            <div class="col-md-12">
                <div class="card card-warning">
                    <div class="card-header">
                        <h3 class="card-title">Monthly New Leads</h3>
                        <div class="card-tools">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                            <button type="button" class="btn btn-tool" data-card-widget="remove"><i
                                    class="fas fa-times"></i></button>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="chart">
                            <canvas id="monthlyLeadsChartDashboard"
                                style="min-height: 250px; height: 250px; max-height: 250px; width: 100%;"></canvas>
                        </div>
                    </div>
                    <!-- /.card-body -->
                </div>
            </div>
        </div>

        {% endif %}


        <div class="row" id="newleads-section">
            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header" style="height: 58px;">
                        <h3 class="card-title filterheader">Today's Leads(<span id="newleadcount">{{ newleadsarr|length }}</span>)<img src="{% static 'images/ajax-loader.gif' %}" max-width="30"
                                style="display:none;" id="newleadload" class="img-responsive" /></h3>
                        <div class="card-tools filter1">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <br>
                    <div class="card-body" style="max-height: 300px;overflow: auto;">
                        <div class="card-body table-responsive p-0">
                            <table class="table table-hover text-nowrap">
                                <thead>
                                    <tr>
                                        <th>Lead ID</th>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Stage</th>
                                        <th>Source</th>
                                        <th>Created at</th>
                                        <th>Updated at</th>
                                    </tr>
                                </thead>
                                <tbody id="leadperdaytable">
                                    {% if newleadsarr %}
                                    {% for newleads in newleadsarr %}
                                    <tr>
                                        <td>{{ newleads.id }}</td>
                                        <td><a href="{% url 'lead_update' id=newleads.id %}" target="_blank">{{ newleads.name }}</a></td>
                                        <td>{{ newleads.phone }}</td>
                                        <td>{{ newleads.lead_status_id }}</td>
                                        <td>{{ newleads.lead_source_id }}</td>
                                        <td>{{ newleads.created_at }}</td>
                                        <td>{{ newleads.updated_at }}</td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="7">No Leads</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" id="updateleads-section">
            <div class="col-md-12 mt-4">
                <div class="card card-info">
                    <div class="card-header" style="height: 58px; display: flex; align-items: center; justify-content: space-between;">
                        <h3 class="card-title filterheader mt-5">Updates Per Day(<span id="updateleadcount">{{ updateleadsarr|length }}</span>)<img src=""
                                max-width="30" style="height: 58px; display: flex; align-items: center; justify-content: space-between;" id="updateleadload" class="img-responsive" /></h3>
                        <div class="cardfilter" style="display: flex; align-items: center; ">
                            <input id="leadupdate_date_range" autocomplete="off" placeholder="Filter by Date range"
                                type="text" class="form-control filterdaterange" name="leadupdate_date_range" value="">
                            <input id="updateleaddate_range" autocomplete="off" placeholder="Filter by Date" type="text"
                                class="form-control filterdate" name="updateleaddate_range" value="">
                            <button type="button" class="btn btn-tool resetfilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools filter1">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <br>
                    <div class="card-body" style="max-height: 300px;overflow: auto;">
                        <div class="card-body table-responsive p-0">
                            <table class="table table-hover text-nowrap">
                                <thead>
                                    <tr>
                                        <th>Lead ID</th>
                                        <th>Name</th>
                                        <th>Phone</th>
                                        <th>Stage</th>
                                        <th>Source</th>
                                        <th>Created at</th>
                                        <th>Updated at</th>
                                    </tr>
                                </thead>
                                <tbody id="updateleadtable">
                                    {% if updateleadsarr %}
                                    {% for updatelead in updateleadsarr %}
                                    <tr>
                                        <td>{{ updatelead.id }}</td>
                                        <td><a href="{% url 'lead_update' id=updatelead.id %}" target="_blank">{{ updatelead.name }}</a></td>
                                        <td>{{ updatelead.phone }}</td>
                                        <td>{{ updatelead.lead_status_id }}</td>
                                        <td>{{ updatelead.lead_source_id }}</td>
                                        <td>{{ updatelead.created_at }}</td>
                                        <td>{{ updatelead.updated_at }}</td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="7">No Leads</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="row" id="leadslog-section">
            <div class="col-md-12">
                <div class="card card-info">
                    <div class="card-header" style="height: 58px; display: flex; align-items: center; justify-content: space-between;">
                        <h3 class="card-title filterheader">Lead Logs Per Day(<span id="logleadcount">{{ logleadsarr|length }}</span>)<img src="{% static 'images/ajax-loader.gif' %}"
                                max-width="30" style="display:none;" id="logleadload" class="img-responsive" /></h3>
                        <div class="cardfilter"  style="display: flex; align-items: center; ">
                            <input id="leadlog_date_range" autocomplete="off" placeholder="Filter by Date range"
                                type="text" class="form-control filterdaterange" name="leadlog_date_range" value="">
                            <input id="logleaddate_range" autocomplete="off" placeholder="Filter by Date" type="text"
                                class="form-control filterdate" name="logleaddate_range" value="">
                            <button type="button" class="btn btn-tool resetfilter" onclick="resetfilter()"><i
                                    class="fas fa-refresh"></i></button>
                        </div>
                        <div class="card-tools filter1">
                            <button type="button" class="btn btn-tool" data-card-widget="collapse"><i
                                    class="fas fa-minus"></i></button>
                        </div>
                    </div>
                    <br>
                    <div class="card-body" style="max-height: 300px;overflow: auto;">
                        <div class="card-body table-responsive p-0">
                            <table class="table table-hover text-nowrap">
                                <thead>
                                    <tr>
                                        <th>Lead ID</th>
                                        <th>Subject</th>
                                        <th>Timing</th>
                                        <th>Change By</th>
                                    </tr>
                                </thead>
                                <tbody id="logleadtable">
                                    {% if logleadsarr %}
                                    {% for loglead in logleadsarr %}
                                    <tr>
                                        <td>{{ loglead.lead_id }}</td>
                                        <td>
                                            {% if loglead.field_change == 1 %}
                                            Field Change
                                            {% else %}
                                            Status Change
                                            {% endif %}
                                        </td>
                                        <td>{{ loglead.created_at }}</td>
                                        <td>{{ loglead.user.name }}</td>
                                    </tr>
                                    {% endfor %}
                                    {% else %}
                                    <tr>
                                        <td colspan="4">No Leads</td>
                                    </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div><!-- /.container-fluid -->
</section>
<!-- /.content -->


<div class="modal fade" id="clicktocall" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel"
        aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Click2call</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <input type="hidden" value="" id="ivr_customer_number" />
                    <input type="hidden" value="" id="leadid">
                    <label for="attachmentInputFile">Select User</label>
                    <div class="input-group">
                        <select id="ivr_user_id" class="form-control">
                            {% for user in ivruser %}
                                <option value="{{ user.user_id }}">{{ user.name }}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <p class="ivrresponse"></p>
                    <img src="{% static 'images/ajax-loader.gif' %}" id="ivrload" style="display:none;" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-danger pull-right" data-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary pull-left" id="callivf">Call Now</button>
            </div>
        </div>
    </div>
</div>


<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datepicker/1.11.0/js/bootstrap-datepicker.min.js"></script>
<!-- <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script> -->
<script src="{% static 'dashboard/plugins/chart.js/Chart.min.js' %}"></script>
<!-- <script src="{% static 'admin-lte/plugins/datetimepicker/jquery.datetimepicker.full.min.js' %}"></script> -->
<script src="{% static 'admin-lte/plugins/datetimepicker/jquery.datetimepicker.js' %}"></script>

<script src="{% static 'dashboard/plugins/daterangepicker/daterangepicker.js' %}"></script>







<script>


function getMonthName(month) {
    const months = [
        "January", "February", "March", "April", "May", "June",
        "July", "August", "September", "October", "November", "December"
    ];
    return months[month - 1] || "";
}


    $(function(){

    var leadTypeData = JSON.parse('{{ leadTypeData|escapejs }}');
    var leadTypeLabels = leadTypeData.map(item => item.lead_type_id__name);
    var leadTypeTotals = leadTypeData.map(item => item.total);
    // console.log(leadTypeData);
    // console.log('-----leadtypedata-----',leadTypeLabels, leadTypeTotals);



        if ($('#leadTypeChartDashboard').length) {

            var barChartCanvas = $('#leadTypeChartDashboard').get(0).getContext('2d')
            var myChart = new Chart(barChartCanvas, {
            type: 'bar',
            data: {
                labels: leadTypeLabels,
                datasets: [{
                label: 'Total Leads',
                data: leadTypeTotals,
                backgroundColor: [
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)',


                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',

                ],
                borderColor: [
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',
                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)',

                    'rgba(255,99,132,1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',


                ],
                borderWidth: 1
                }]
            },
            options: {
                responsive: false,
                scales: {
                xAxes: [{
                    ticks: {

                    }
                }],
                yAxes: [{
                    ticks: {
                        beginAtZero: true,
                        precision: 0
                    }
                }]
                }
            }
            });

        }

    try {
        var monthlyData = JSON.parse('{{ monthlyData|escapejs }}');

        // var aggregatedMonthlyData = [];

        // monthlyData.forEach(item => {
        //     var monthIndex = item.created_at__month - 1;
        //     if (!aggregatedMonthlyData[monthIndex]) {
        //         aggregatedMonthlyData[monthIndex] = {
        //             created_at__month: item.created_at__month,
        //             month_total: item.month_total
        //         };
        //     } else {
        //         // Increment lead count by 1 for the same month
        //         aggregatedMonthlyData[monthIndex].month_total += 1;
        //     }
        // });

        // var monthlyLabels = monthlyData.map(item => getMonthName(item.created_at__month));
        // var monthlyTotals = monthlyData.map(item => item.month_total);

        var monthlyCounts = {};

        monthlyData.forEach(item => {
            var monthName = getMonthName(item.created_at__month);
            if (!monthlyCounts[monthName]) {
                monthlyCounts[monthName] = 1;
            } else {
                monthlyCounts[monthName] += 1;
            }
        });

        var monthlyLabels = Object.keys(monthlyCounts);
        var monthlyTotals = Object.values(monthlyCounts);
        console.log('-----monthlydata-----', monthlyLabels, monthlyTotals);

        if ($('#monthlyLeadsChartDashboard').length) {
            var barChartCanvas = $('#monthlyLeadsChartDashboard').get(0).getContext('2d');
            var myChart = new Chart(barChartCanvas, {
                type: 'bar',
                data: {
                    labels: monthlyLabels,
                    datasets: [{
                        label: 'Total Leads',
                        data: monthlyTotals,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                        xAxes: [{
                            ticks: {

                            }
                        }],
                        yAxes: [{
                            ticks: {
                                beginAtZero: true,
                                precision: 0
                            }
                        }]
                    }
                }
            });
        }
    } catch (error) {
        console.error('Error parsing or using monthlyData:', error);
    }




        

})

function ivrcall(phone,leadid=''){
    $('.ivrresponse').empty();
    $("#callivf").show();
    $("#ivr_customer_number").val(phone);
	$("#leadid").val(leadid);

    $('#clicktocall').modal('show'); 
}
$("#callivf").on("click", function(){
    $(this).hide();
    $('#ivrload').show();
    var customer = $('#ivr_customer_number').val();
    var leadid = $('#leadid').val();
    var ivruser = $('select#ivr_user_id option:selected').val();
    //console.log(ivruser+'-------'+customer);

    $.ajax({
        url: '',
        data: {'user_id': ivruser, 'customer':customer,'leadid':leadid},
        dataType: 'json',
        method:'post',
        success: function(data)
        {
            $('.ivrresponse').empty().append(data.message);
            $('#ivrload').hide();
        } 
    });
    $("select#ivr_user_id option").prop("selected", false);
});

// Callbacks Filters

// $(function() {
//     $('input#call_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#call_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selected = {};
//     selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
//     $('#callload').show();
//     $.ajax({
//         url: '/callbackfilter/',
//         data: {'daterange':selecteddate},
//         dataType: 'json',
//         method:'post',
//         success: function(data)
//         {
//             $('#callload').hide();
//             $('#callbacktable').empty().append(data.html); 
//             $('#callbackfiltercount').html(data.count); 
//         } 
//     });
// });

// $('input#call_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });
// $(function() {
//     $('#filterdate_range').datetimepicker({
//         format:'Y-m-d',
//         minView: 2,
//         timepicker: false,
//         dateonly: true,
//         minDate:new Date(),
//         onChangeDateTime:function(dp,$input){
//             $.ajax({
//                 url: '/callbackfilter/',
//                 data: {'date':$input.val()},
//                 dataType: 'json',
//                 method:'post',
//                 success: function(data)
//                 {
//                     $('#callbacktable').empty().append(data.html); 
//                     $('#callbackfiltercount').html(data.count); 
//                     $('#callload').hide(); 
//                 } 
//             });
//         }
//     });
// });


$(function() {
    // Initialize date range picker
    $('input#call_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    // Apply date range filter
    $('input#call_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {
            'startDate': picker.startDate.format('YYYY-MM-DD'),
            'endDate': picker.endDate.format('YYYY-MM-DD')
        };
        console.log("Selected Date:", selecteddate);

        // Perform AJAX request for callback filter
        updateCallbackFilter(selecteddate);
    });

    // Clear date range filter
    $('input#call_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });
    
    // Initialize date filter using datetimepicker
    $('#filterdate_range').datetimepicker({
        format: 'Y-m-d',
        minView: 2,
        timepicker: false,
        dateonly: true,
        minDate: new Date(),
        onChangeDateTime: function(dp, $input) {
            // Perform AJAX request for callback filter using date filter
            updateCallbackFilter({ 'date': $input.val() });
        }
    });
});

// Function to perform AJAX request for callback filter
function updateCallbackFilter(filterData) {
    $('#callload').show();

    // Perform the AJAX request
    $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
    $.ajax({
        url: '/callbackfilter/',
        data: filterData,
        dataType: 'json',
        method: 'post',
        success: function(data) {
            $('#callbacktable').empty().append(data.html);
            $('#callbackfiltercount').html(data.count);
            $('#callload').hide();
        }
    });
}



//Previous Callback Filter
// $(function() {
//     $('input#prevcall_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left',
//         maxDate:new Date(),
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#prevcall_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selected = {};
//     selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
//     $('#callload').show();
//     console.log(selecteddate, '---selecteddate--');
//     $.ajax({
//         url: '/prevcallbackfilter/',
//         data: {'daterange':selecteddate},
//         dataType: 'json',
//         method:'post',
//         success: function(data)
//         {
//             $('#prevcallbacktable').empty().append(data.html); 
//             $('#pendingcallfiltercount').html(data.count); 
//             $('#prevcallload').hide(); 

//         } 
//     });
// });

// $('input#prevcall_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });
// $(function() {
//     $('#prevfilterdate_range').datetimepicker({
//         format:'Y-m-d',
//         minView: 2,
//         timepicker: false,
//         dateonly: true,
//         maxDate:new Date(),
//         onChangeDateTime:function(dp,$input){
//                      // $.ajaxSetup({
//             //       headers: {
//             //           "X-CSRFToken": "{{ csrf_token }}"
//             //       }
//             //   });

//             // $.ajax({
//             //     url: "{% url 'prevcallbackfilter' %}",
//             $.ajaxSetup({
//                 headers: {
//                     "X-CSRFToken": csrfToken
//                 }
//             });
//             var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
//             $.ajax({
//                 url: '/prevcallbackfilter/',
//                 data: {'date':$input.val()},
//                 dataType: 'json',
//                 method:'post',
//                 success: function(data)
//                 {
//                     $('#prevcallbacktable').empty().append(data.html); 
//                     $('#pendingcallfiltercount').html(data.count); 
//                     $('#prevcallload').hide(); 
//                 } 
//             });
//         }
//     });
// });


//Previous Callback Filter
// $(function() {
//     $('input#prevcall_date_range').daterangepicker({
//         autoUpdateInput: false, // Prevent automatic input update
//         opens: 'left',
//         maxDate: new Date(),
//     }, function(start, end, label) {
//         // This function will be called when the "Apply" button is clicked
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#prevcall_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selecteddate = {'startDate': picker.startDate.format('YYYY-MM-DD'), 'endDate': picker.endDate.format('YYYY-MM-DD')};
//     $('#callload').show();
//     console.log(selecteddate, '---selecteddate--');
//     $.ajax({
//         url: '/prevcallbackfilter/',
//         data: {'daterange': selecteddate},
//         dataType: 'json',
//         method: 'post',
//         success: function(data) {
//             $('#prevcallbacktable').empty().append(data.html); 
//             $('#pendingcallfiltercount').html(data.count); 
//             $('#prevcallload').hide(); 
//         } 
//     });
// });

// $('input#prevcall_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });


$(document).ready(function() {
    // Initialize the date range picker
    $('input#count_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left',
        maxDate: new Date(),
    }, function(start, end, label) {
        // This function will be called when the "Apply" button is clicked
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    // Apply event handler for date range picker
    $('input#count_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {'startDate': picker.startDate.format('YYYY-MM-DD'), 'endDate': picker.endDate.format('YYYY-MM-DD')};
        $('#callload').show();
        
        // Perform AJAX request
        $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
        $.ajax({
            url: '/dashboardCount/',
            data: {'daterange': selecteddate},
            dataType: 'json',
            method: 'post',
            success: function(data) {
                // console.log(data)
                // $('#prevcallbacktable').empty().append(data.html); 
                // $('#pendingcallfiltercount').html(data.count); 
                // $('#prevcallload').hide(); 
                $('.totl_leads').text(data.totalLeads);
                $('.ConvertedLeads').text(data.totalConvertedLeads);
                $('.qualifd_leads').text(data.total_qualified);
                $('.disqualifd_leads').text(data.total_disqualified);
                $('.notknows').text(data.total_notknows);
            } 
        });
    });

    // Cancel event handler for date range picker
    $('input#count_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });
});




$(document).ready(function() {
    // Initialize the date range picker
    $('input#prevcall_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left',
        maxDate: new Date(),
    }, function(start, end, label) {
        // This function will be called when the "Apply" button is clicked
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    // Apply event handler for date range picker
    $('input#prevcall_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {'startDate': picker.startDate.format('YYYY-MM-DD'), 'endDate': picker.endDate.format('YYYY-MM-DD')};
        $('#callload').show();
        
        // Perform AJAX request
        $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
        $.ajax({
            url: '/prevcallbackfilter/',
            data: {'daterange': selecteddate},
            dataType: 'json',
            method: 'post',
            success: function(data) {
                $('#prevcallbacktable').empty().append(data.html); 
                $('#pendingcallfiltercount').html(data.count); 
                $('#prevcallload').hide(); 
            } 
        });
    });

    // Cancel event handler for date range picker
    $('input#prevcall_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });
});





$(function() {
    $('#prevfilterdate_range').datetimepicker({
        format: 'Y-m-d',
        minView: 2,
        timepicker: false,
        dateonly: true,
        maxDate: new Date(),
        onChangeDateTime: function(dp, $input) {
            var csrfToken = $('input[name="csrfmiddlewaretoken"]').val();
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": csrfToken
                }
            });
            $.ajax({
                url: '/prevcallbackfilter/',
                data: {'date': $input.val()},
                dataType: 'json',
                method: 'post',
                success: function(data) {
                    $('#prevcallbacktable').empty().append(data.html); 
                    $('#pendingcallfiltercount').html(data.count); 
                    $('#prevcallload').hide(); 
                } 
            });
        }
    });
});



// $(function() {
//     $('input#leadupdate_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#leadupdate_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selected = {};
//     selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
//     $('#callload').show();
//     $.ajax({
//         url: '/updateleadfilter/',
//         data: {'daterange':selecteddate},
//         dataType: 'json',
//         method:'post',
//         success: function(data)
//         {
//             $('#updateleadload').hide();
//             $('#updateleadtable').empty().append(data.html); 
//             $('#updateleadcount').html(data.count); 
//         } 
//     });
// });

// $('input#leadupdate_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });
// $(function() {
//     $('#updateleaddate_range').datetimepicker({
//         format:'Y-m-d',
//         minView: 2,
//         timepicker: false,
//         dateonly: true,
//         maxDate:new Date(),
//         onChangeDateTime:function(dp,$input){
//             $.ajax({
//                 url: '/updateleadfilter/',
//                 data: {'date':$input.val()},
//                 dataType: 'json',
//                 method:'post',
//                 success: function(data)
//                 {
//                     $('#updateleadtable').empty().append(data.html); 
//                     $('#updateleadcount').html(data.count); 
//                     $('#updateleadload').hide(); 
//                 } 
//             });
//         }
//     });
// });


$(function() {
    $('input#leadupdate_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    $('input#leadupdate_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {
            'startDate': picker.startDate.format('YYYY-MM-DD'),
            'endDate': picker.endDate.format('YYYY-MM-DD')
        };
        
        $('#callload').show();
        $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
        $.ajax({
            url: '/updateleadfilter/',
            data: {'daterange': selecteddate},
            dataType: 'json',
            method: 'post',
            success: function(data) {
                $('#updateleadload').hide();
                $('#updateleadtable').empty().append(data.html); 
                $('#updateleadcount').html(data.count); 
            } 
        });
    });

    $('input#leadupdate_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });
});



// $(function() {
//     $('input#leadlog_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#leadlog_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selected = {};
//     selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
//     $('#callload').show();
//     $.ajaxSetup({
//                   headers: {
//                       "X-CSRFToken": "{{ csrf_token }}"
//                   }
//               });
//     $.ajax({
//         url: '/leadlogfilter/',
//         data: {'daterange':selecteddate},
//         dataType: 'json',
//         method:'post',
//         success: function(data)
//         {
//             $('#logleadload').hide();
//             $('#logleadtable').empty().append(data.html); 
//             $('#logleadcount').html(data.count); 
//         } 
//     });
// });

// $('input#leadlog_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });

// $(function() {
//     $('#logleaddate_range').datetimepicker({
//         format:'Y-m-d',
//         minView: 2,
//         timepicker: false,
//         dateonly: true,
//         maxDate:new Date(),
//         onChangeDateTime:function(dp,$input){
//             $.ajax({
//                 url: '/leadlogfilter/',
//                 data: {'date':$input.val()},
//                 dataType: 'json',
//                 method:'post',
//                 success: function(data)
//                 {
//                     $('#logleadtable').empty().append(data.html); 
//                     $('#logleadcount').html(data.count); 
//                     $('#logleadload').hide(); 
//                 } 
//             });
//         }
//     });
// });



$(document).ready(function() {
    // Date Range Picker
    $('input#leadlog_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    $('input#leadlog_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {
            'startDate': picker.startDate.format('YYYY-MM-DD'),
            'endDate': picker.endDate.format('YYYY-MM-DD')
        };
        
        $('#callload').show();

        $.ajaxSetup({
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                }
            });
        $.ajax({
            url: '/leadlogfilter/',
            data: {'daterange': selecteddate},
            dataType: 'json',
            method: 'post',
            success: function(data) {
                $('#logleadload').hide();
                $('#logleadtable').empty().append(data.html);
                $('#logleadcount').html(data.count);
            }
        });
    });

    $('input#leadlog_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });

    // Date-Time Picker
    $('#logleaddate_range').datetimepicker({
        format: 'Y-m-d',
        minView: 2,
        timepicker: false,
        dateonly: true,
        maxDate: new Date(),
        onChangeDateTime: function(dp, $input) {
            $.ajaxSetup({
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}"
                }
            });
            $.ajax({
                url: '/leadlogfilter/',
                data: {'date': $input.val()},
                dataType: 'json',
                method: 'post',
                success: function(data) {
                    $('#logleadtable').empty().append(data.html);
                    $('#logleadcount').html(data.count);
                    $('#logleadload').hide();
                }
            });
        }
    });
});





function resetfilter() {
    location.reload();
}




// $(function() {
//     $('input#status_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#status_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selected = {};
//     var updateddate = {};
//     selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
//     var udate = $('#status_update_date_range').val();
//     if(udate != '') {
//     var date = udate.match(/(.+)-.(.+)/);
//         var start = date[1];
//         var end = date[2];
//         updateddate = {'startDate' : moment(start).format('YYYY-MM-DD'), 'endDate':moment(end).format('YYYY-MM-DD')};
//     }
    
//     leadstatus(selecteddate,updateddate);
// });

// $('input#status_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });
// $(function() {
//     $('input#status_update_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#status_update_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var updateddate = {};
//     var selecteddate = {};
//     updateddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};

//     var cdate = $('#status_date_range').val();
//      if(cdate != '') {
//     var date = cdate.match(/(.+)-.(.+)/);
   
//         var start = date[1];
//         var end = date[2];
//         selecteddate = {'startDate' : moment(start).format('YYYY-MM-DD'), 'endDate':moment(end).format('YYYY-MM-DD')};
//     }
//     leadstatus(selecteddate,updateddate);
// });

// $('input#status_update_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });

$(document).ready(function() {
    // Initialize the date range picker for status_date_range
    $('input#status_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    // Apply event handler for status_date_range
    $('input#status_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {
            'startDate': picker.startDate.format('YYYY-MM-DD'),
            'endDate': picker.endDate.format('YYYY-MM-DD')
        };
        
        var updateddate = {};
        var udate = $('#status_update_date_range').val();
        if (udate != '') {
            var date = udate.match(/(.+)-.(.+)/);
            var start = date[1];
            var end = date[2];
            updateddate = {
                'startDate': moment(start).format('YYYY-MM-DD'),
                'endDate': moment(end).format('YYYY-MM-DD')
            };
        }

        leadstatus(selecteddate, updateddate);
    });

    // Cancel event handler for status_date_range
    $('input#status_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });

    // Initialize the date range picker for status_update_date_range
    $('input#status_update_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    // Apply event handler for status_update_date_range
    $('input#status_update_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var updateddate = {
            'startDate': picker.startDate.format('YYYY-MM-DD'),
            'endDate': picker.endDate.format('YYYY-MM-DD')
        };

        var selecteddate = {};
        var cdate = $('#status_date_range').val();
        if (cdate != '') {
            var date = cdate.match(/(.+)-.(.+)/);
            var start = date[1];
            var end = date[2];
            selecteddate = {
                'startDate': moment(start).format('YYYY-MM-DD'),
                'endDate': moment(end).format('YYYY-MM-DD')
            };
        }

        leadstatus(selecteddate, updateddate);
    });

    // Cancel event handler for status_update_date_range
    $('input#status_update_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });

    // Call leadstatus initially
    leadstatus();
});




$(function() {
    $('input#source_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });
});

$('input#source_date_range').on('apply.daterangepicker', function(ev, picker) {
    $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

    var selected = {};
    var updateddate = {};
    selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
    var udate = $('#status_update_date_range').val();
    if(udate != '') {
    var date = udate.match(/(.+)-.(.+)/);
        var start = date[1];
        var end = date[2];
        //updateddate = {'startDate' : moment(start).format('YYYY-MM-DD'), 'endDate':moment(end).format('YYYY-MM-DD')};
    }
    
    leadsource(selecteddate,updateddate);
});

$('input#source_date_range').on('cancel.daterangepicker', function(ev, picker) {
    $(this).val('');
});




// $(function() {
//     $('input#weekly_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#weekly_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selected = {};
   
//     selecteddate = {'startDate' : picker.startDate.format('YYYY-MM-DD'), 'endDate':picker.endDate.format('YYYY-MM-DD')};
//     weeklylead(selecteddate);
// });

// $('input#weekly_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
    
// });


// $(function() {
//     $('input#weekly_date_range').daterangepicker({
//         autoUpdateInput: false,
//         opens: 'left'
//     }, function(start, end, label) {
//         console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
//     });
// });

// $('input#weekly_date_range').on('apply.daterangepicker', function(ev, picker) {
//     $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

//     var selecteddate = {
//         'startDate': picker.startDate.format('YYYY-MM-DD'),
//         'endDate': picker.endDate.format('YYYY-MM-DD')
//     };
//     console.log("Selected Date:", selecteddate);
    
//     weeklylead(selecteddate);
// });

// $('input#weekly_date_range').on('cancel.daterangepicker', function(ev, picker) {
//     $(this).val('');
// });



$(document).ready(function() {
    $('input#weekly_date_range').daterangepicker({
        autoUpdateInput: false,
        opens: 'left'
    }, function(start, end, label) {
        console.log("A new date selection was made: " + start.format('YYYY-MM-DD') + ' to ' + end.format('YYYY-MM-DD'));
    });

    $('input#weekly_date_range').on('apply.daterangepicker', function(ev, picker) {
        $(this).val(picker.startDate.format('MM/DD/YYYY') + ' - ' + picker.endDate.format('MM/DD/YYYY'));

        var selecteddate = {
            'startDate': picker.startDate.format('YYYY-MM-DD'),
            'endDate': picker.endDate.format('YYYY-MM-DD')
        };
        console.log("Selected Date:", selecteddate);

        // Perform AJAX request for weekly leads
        weeklylead(selecteddate);
    });

    $('input#weekly_date_range').on('cancel.daterangepicker', function(ev, picker) {
        $(this).val('');
    });
});





leadstatus();
function leadstatus(selecteddate="",updateddate=""){
    $('#leadStatusChartDashboard').remove();
    $('#leadstatuschart').append('<canvas id="leadStatusChartDashboard" style="min-height:250px;height: 250px; max-height:250px;width:100%;"></canvas>');
    $('#statusload').show();
    $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
    $.ajax({
        url: "{% url 'leadstatusgraph' %}",
        data: {daterange:selecteddate,updateddate:updateddate},
        dataType: 'json',
        method:'post',
        success: function(responce)
        {
            if ($('#leadStatusChartDashboard').length) {

                var barChartCanvas = $('#leadStatusChartDashboard').get(0).getContext('2d')
                var myChart = new Chart(barChartCanvas, {
                type: 'bar',
                data: {
                    labels: responce.labels,
                    datasets: [{
                    label: 'Total Leads - '+responce.totalleads,
                    data: responce.finalarray,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                    xAxes: [{
                        ticks: {

                        }
                    }],
                    yAxes: [{
                        ticks: {
                             beginAtZero: true,
                             precision: 0
                        }
                    }]
                    }
                }
                });
            }
            $('#statusload').hide();
        } 
    });
}


function weeklylead(selecteddate=""){
    console.log("Weekly selected date:", selecteddate);
    $('#weeklyLeadsChartDashboard').remove();
    $('#weeklyleadchart').append('<canvas id="weeklyLeadsChartDashboard" style="min-height: 250px; height: 250px; max-height: 250px; width: 100%;"></canvas>');
    $('#weeklyload').show();
    $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
    $.ajax({
        url:"{% url 'weeklyleadgraph' %}",
        data: {daterange:selecteddate},
        dataType: 'json',
        method:'post',
        success: function(responce)
        {
            if ($('#weeklyLeadsChartDashboard').length) {

               var barChartCanvasnew = $('#weeklyLeadsChartDashboard').get(0).getContext('2d')
                var myChartnew = new Chart(barChartCanvasnew, {
                type: 'bar',
                data: {
                    labels: responce.labels,
                    datasets: [{
                    label: 'Total Leads',
                    data: responce.finalarray,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                    }]
                },
                options: {
                    responsive: false,
                    scales: {
                    xAxes: [{
                        ticks: {

                        }
                    }],
                    yAxes: [{
                        ticks: {
                             beginAtZero: true,
                             precision: 0
                        }
                    }]
                    }
                }
                });

            }
            $('#weeklyload').hide();
        } 
    });
}
weeklylead();

leadsource();


function leadsource(selecteddate="",updateddate=""){
    $('#leadSourceChartDashboard').remove();
    $('#leadsourcechart').append('<canvas id="leadSourceChartDashboard" style="min-height:250px;height: 250px; max-height:250px;width:100%;"></canvas>');
    $('#sourceload').show();
    $.ajaxSetup({
                  headers: {
                      "X-CSRFToken": "{{ csrf_token }}"
                  }
              });
    $.ajax({
        url: "/leadsourcegraph/",
        data: {daterange:selecteddate,updateddate:updateddate},
        dataType: 'json',
        method:'post',
        success: function(responce)
        {
            if ($('#leadSourceChartDashboard').length) {

                var barChartCanvas = $('#leadSourceChartDashboard').get(0).getContext('2d')
                var myChart = new Chart(barChartCanvas, {
                type: 'bar',
                data: {
                    labels: responce.labels2,
                    datasets: [{
                    label: "Total Leads "+responce.sumarray,
                    data: responce.secondSumArray,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)',
                        'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        'rgba(255, 206, 86, 0.2)',
                        'rgba(75, 192, 192, 0.2)',
                        'rgba(153, 102, 255, 0.2)',
                        'rgba(255, 159, 64, 0.2)'
                    ],
                    borderColor: [
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(255,99,132,1)',
                        'rgba(54, 162, 235, 1)',
                        'rgba(255, 206, 86, 1)',
                        'rgba(75, 192, 192, 1)',
                        'rgba(153, 102, 255, 1)',
                        'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                    }]
                },
                 options: {
                        responsive: false,
                        scales: {
                            xAxes: [{
                                ticks: {
                                }
                            }],
                            yAxes: [{
                                ticks: {
                                    beginAtZero: true,
                                    precision: 0
                                }
                            }]
                        },
                        tooltips: {
                            enabled: true,
                            mode: 'single',
                            callbacks: {
                                label: function(tooltipItems, data) {
                                    var multistringText = [];
                                    var obj = responce.object2;
                                    var multistringText = ["Total: " + tooltipItems.yLabel];
                                    var stages= new Array('Immediate','HOT','Warm','COLD','Baat nahi ho payi hai');

                                    $.each(JSON.parse(obj), function(key,value) {
                                        $.each(value, function(innerKey, innerValue) {
                                            console.log(innerKey);
                                            if(innerKey == 'Immediate') {
                                                if (key.toLowerCase() == (tooltipItems.label).toLowerCase()) {
                                                    multistringText.push(innerKey +": "+innerValue);
                                                }
                                            }
                                                
                                            if(innerKey == 'Hot') {
                                                if (key.toLowerCase() == (tooltipItems.label).toLowerCase()) {
                                                    multistringText.push(innerKey +": "+innerValue);
                                                }
                                            }
                                            if(innerKey == 'Warm') {
                                                if (key.toLowerCase() == (tooltipItems.label).toLowerCase()) {
                                                    multistringText.push(innerKey +": "+innerValue);
                                                }
                                            }
                                            if(innerKey == 'Cold') {
                                                if (key.toLowerCase() == (tooltipItems.label).toLowerCase()) {
                                                    multistringText.push(innerKey +": "+innerValue);
                                                }
                                            }
                                            if(innerKey == 'Baat Nahi Ho Payi Hai') {
                                                if (key.toLowerCase() == (tooltipItems.label).toLowerCase()) {
                                                    multistringText.push(innerKey +": "+innerValue);
                                                }
                                            }
                                        })
                                    });
                                    return multistringText;
                                }
                            }
                        },
                    }
                });
            }
            $('#sourceload').hide();
        } 
    });
}
</script>



{% endblock %}